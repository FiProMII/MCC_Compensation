@{ ViewBag.Title = "CA-FORGOT PASSWORD";}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <link href="~/lib/twitter-bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" rel="stylesheet" />
</head>
<body>
    <header class="footer mt-auto py-3 bg-transparent">
        <div style="position: fixed; left: 0; bottom: 10px; width: 100%; color: transparent; text-align:center; color:black">

        </div>
    </header>
    <div class="container-fluid">
        <div class="flex-md-wrap container col-lg-4 align-content-center">
            <div class="card-container">
                <div class="card-body">
                    <h3 class="text-center m-0">
                        <a href="" class="logo logo-admin">
                            <img src="~/src/images/mii-logo.png" height="50" alt="logo" />
                        </a>
                    </h3>
                    <div class="p-3">
                        <h4 class="text-muted font-18 m-b-5 text-center">Welcome Back !</h4>
                        <p class="text-muted text-center">You request to change password</p>
                        <form id="form" name="form">
                            <div class="form-group">
                                <label for="password" class="col-form-label">New Password</label>
                                <input type="password" class="form-control" name="password" id="newPassword" placeholder="Enter New Password" autocomplete="off">
                            </div>
                            <div class="form-group">
                                <label for="password" class="col-form-label">Confirm New Password</label>
                                <input type="password" class="form-control" name="confirm-password" id="confirmPassword" placeholder="Confirm New Password" autocomplete="off">    
                                <span id="passwordmatch" style="display:none; color:red">Password doesn't match</span>
                            </div>
                            <br /><br />
                            <div class="form-group row m-t-20">
                                <div class="col-sm-12 text-right">
                                    <button class="btn btn-primary" type="submit" id="submit">Submit</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer mt-auto py-3 bg-transparent">
        <div style="position: fixed; left: 0; bottom: 10px; width: 100%; color: transparent; text-align:center; color:black">
            &copy; 2021 PT Mitra Integrasi Informatika. All Rights Reserved.
        </div>
    </footer>
</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="~/lib/twitter-bootstrap/js/bootstrap.min.js"></script>
<script src="~/lib/twitter-bootstrap/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script>
    $('#confirmPassword').keyup(function () {
        var pass = $('#newPassword').val();
        var cpass = this.value;
        if (cpass != pass) {
            $('#passwordmatch').show();
            $('#confirmPassword').focus(
                function () {
                    $('#passwordmatch').hide();
                });
            $('#submit').attr('disable', true);
        } else {
            $('#passwordmatch').hide();
            $('#submit').attr('disable', false);
        }
    })

    var validator = $('#form').validate({
        rules: {
            newPassword: "required",
            confirmPassword: "required"
        },
        messages: {
            newPassword: "<p style='color:red'>Please enter new password</p>",
            confirmPassword: "<p style='color:red'>Please retype new password</p>"
        },
        submitHandler: function (form) {
            var form = $(form);
            $.ajax({
                type: "POST",
                url: "Put",
                data: form.serialize(),
                success: function (data) {
                    Swal.fire({
                        title: 'Password has been changed',
                        icon: 'success',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = @Url.Action("Index", "Account");
                        }
                    })
                },
                error: function (error) {

                }
            });
        }
    });
</script>
