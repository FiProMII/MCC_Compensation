@{ Layout = "_Layout";
    ViewBag.Title = "Compensation Request";
}

<div class="container">
    <br />
    <div class="col-sm-12 text-right">
        <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item active">Compensation Request</li>
        </ol>
    </div>
    <h2 class="page-header">
        <i class="fas fa-clipboard-check"></i> Compensation Request
    </h2>
    <br />
    <div>
        <table id="table_id" class="table table-sm table-striped table-bordered m-2">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Request ID</th>
                    <th>Applicants Name</th>
                    <th>Join Date</th>
                    <th>Manager</th>
                    <th>Submission</th>
                    <th>Event Date</th>
                    <th>Request Date</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            <tfoot>
                <tr>
                    <th>No.</th>
                    <th>Request ID</th>
                    <th>Applicants Name</th>
                    <th>Join Date</th>
                    <th>Manager</th>
                    <th>Submission</th>
                    <th>Event Date</th>
                    <th>Request Date</th>
                    <th>Details</th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

@section scripts
{
    <script>
        var isUpdate = 0;
        $(document).ready(function () {
            debugger;
            table = $('#table_id').DataTable({
                dom: "<'row'<'col-sm-5'l><'col-sm-4 text-center'B><'col-sm-3'f>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row'<'col-sm-6'i><'col-sm-6'p>>",
                buttons: [
                    {
                        extend: 'csv',
                        exportOptions: {
                            columns: [0, 2]
                        }
                    },
                    {
                        extend: 'excel',
                        exportOptions: {
                            columns: [0, 2]
                        }
                    },
                    {
                        extend: 'pdf',
                        exportOptions: {
                            columns: [0, 2]
                        }
                    }
                ],
                "responsive": true,
                "filter": true,
                "orderMulti": false,
                "ajax": {
                    "url": "Get",
                    "type": "Get",
                    "dataSrc": "result"
                },
                "columnDefs": [
                    {
                        "targets": [1],
                        "visible": false,
                    },
                    {
                        "targets": [0, 8],
                        "orderable": false,
                    },
                    {
                        "targets": [0, 1, 3, 5, 6, 7, 8],
                        "className": "texUrl-center",
                    },
                    {
                        "order": [[2, 'asc']]
                    }
                ],
                "columns": [
                    {
                        "data": null,
                        "name": "no",
                        "autowidth": true,
                        "render": function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    { "data": 'requestID' },
                    { "data": 'employee.employeeName' },
                    {
                        "data": 'employee.joinDate',
                        "render": function (data, type, row) {
                            return moment(data).format('DD/MM/YYYY');
                        }
                    },
                    { "data": 'employee.manager.employeeName' },
                    { "data": 'compensation.compensationName' },
                    {
                        "data": 'eventDate',
                        "render": function (data, type, row) {
                            return moment(data).format('DD/MM/YYYY');
                        }
                    },
                    {
                        "data": 'requestDate',
                        "render": function (data, type, row) {
                            return moment(data).format('DD/MM/YYYY');
                        }
                    },
                    {
                        "data": 'requestID',
                        "render": function (data, type, row, meta) {
                            return '<a class="btn btn-outline-info" data-toggle="tooltip" data-placement="top" title="Detail Information"  href="/Request/Details/?id=' + row['requestID'] +'"><i class="fas fa-info-circle"></i> Details</a> '
                        }
                    }
                ]
            });

            // Array to track the ids of the details displayed rows
            var detailRows = [];

            $('#table_id tbody').on('click', 'tr td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = dt.row(tr);
                var idx = $.inArray(tr.attr('id'), detailRows);

                if (row.child.isShown()) {
                    tr.removeClass('details');
                    row.child.hide();

                    // Remove from the 'open' array
                    detailRows.splice(idx, 1);
                }
                else {
                    tr.addClass('details');
                    row.child(format(row.data())).show();

                    // Add to the 'open' array
                    if (idx === -1) {
                        detailRows.push(tr.attr('id'));
                    }
                }
            });

            // On each draw, loop over the `detailRows` array and show any child rows
            dt.on('draw', function () {
                $.each(detailRows, function (i, id) {
                    $('#' + id + ' td.details-control').trigger('click');
                });
            });
        });

        function format(d) {
            return 'Full name: ' + d.requestID + '<br>' +
                'Salary: ' + d.eventDate + '<br>' +
                'The child row can contain any data you wish, including links, images, inner tables etc.';
        }

    </script>
}